LAST CHANGED    : 2024/01/06 23:37:40
CRUISE NAME(S)  : TN427
CRUISE DATES    : 2023/12/30  02:52:09 to 2024/01/06  23:37:09
SHIP NAME       : unspecified
PORTS           : unspecified
CHIEF SCIENTIST : unspecified
DATABASE NAME   : a_tt
DATA FILES      : tt2023_363_10028.raw to tt2024_005_79200.raw

STATUS          :  to do                           done
                  ------                       -----------
                  averaged                       [     ]
                  loaded                         [     ]

                  NOTE: heading correction instrument exists
                        NOTE: time-dependent heading corrections
                        applied IN the ensembles
                        (see   cal/rotate/ens_hcorr.ang)

                  check heading correction       [     ]
                  calibration                    [     ]
                  edited                         [     ]
                  re-check heading correction    [     ]
                  check editing                  [     ]
                  figures                        [     ]

INSTRUMENT      : os75

ACQUISITION     : 
     PROGRAM    : uhdas
     PROCESSING:    : python

LOGGING         : 

     PARAMETERS : BT : bottom track mode (on or off)
                  SI : sampling interval or averaging period for ensemble (sec)
                  NB : number of bins
                  BL : bin length (m)
                  TD : transducer depth (m)
                  BK : blanking length (m)
                  HO : heading offset applied by DAS (deg)
                  HB : heading bias (deg)
                  CRPH : compensation for roll-pitch-heading, 1:on, 0:off)
                  
                  yy/mm/dd  hh:mm:ss   BT   SI  NB  BL  TD BK     HO     HB CRPH
                  2023/12/30 02:52:09  off  300  60  16   5  8  59.90   0.00 0001

HEADING         : 
     PRIMARY    : heading from gyro1
     CORRECTION : heading correction from posmv5
                        NOTE: time-dependent heading corrections
                        applied IN the ensembles
                        (see   cal/rotate/ens_hcorr.ang)

POSITIONS       : gps positions from posmv5

CALIBRATION     : (check original processing parameters)
                  (1) transducer alignment
                      original transducer alignment: 
                      additional rotation 0
                      final transducer angle is:
                           (original transducer angle) - (rotate_angle)
                  
                  (2) scale factor
                      original scale factor 1
                      additional scale factor (none)
                  
                  (3) ADCP (dx=starboard, dy=fwd) meters from GPS
                    original:        xducer_dx          xducer_dy
                    correction           -3                 7
                    final offset          ?                  ?
                         final = original +  corrections 
                  

COMMENTS        : gaps in heading correction?
                  scattering layers?
                  bubbles?
                  underway bias?
                  
PROCESSOR       : I.M. Persistent


--- original processing parameters from dbinfo.txt ----------

<...> NOTE: Replace the text below with the final dbinfo.txt content
<...>        after you are done with all postprocessing.  Change the
<...>        comment to say "final processing parameters" 

## (determined from "sonar"): model = os
## (determined from "sonar"): frequency = 75
## (determined from "sonar"): instname = os75
## (determined from "sonar"): pingtype = nb
           beamangle   30
          cruisename   TN427
            datatype   uhdas
              dbname   a_tt
             ens_len   300
             fixfile   a_tt.gps
           frequency   75
          hcorr_inst   posmv5
            instname   os75
               model   os
            pingtype   nb
         proc_engine   python
          ref_method   refsm
     refuv_smoothwin   3
        refuv_source   nav
               sonar   os75nb
            txy_file   a_tt.agt
           xducer_dx   -3
           xducer_dy   7
            yearbase   2023

Cruise TN413 processing:

Note that the structure of this documentation comes from https://currents.soest.hawaii.edu/docs/adcp_doc/APPENDIX/txtfile_wrappers/km1001c_postproc_os38nb.html#km1001c-postproc-os38nb

The os75nb at-sea processing directory was copied from
the "proc" directory of the TN413 cruise disk.

All postprocessing is done with full codas+python (i.e. using
numpy+matplotlib)

(1) Make directory os75nb for post-procssing

- copy proc/os75nb directory from cruise disk

     (i) copy the os75nb directory to "pyproc" and rename to "postproc_os75nb_pre_mask"
     (ii) make another copy called "preproc_os75nb" for later comparison

- start editing a text file called 2023_os75nb_postproc.txt, with thecontents of os75nb/cruise_info.txt at the top.
- keep notes down below, and fill in above later
   Look at the cruise track to see what we're expecting by opening pngs under "png_archive"

(2) check accurate heading device (POSMV):
- look at figures in cal/rotate *hcorr.png for gaps
  (gaps would be red "+" signs -- there are none)

conclude: no action needed


(3) check calibration:


      (a)  look at heading correction: are there gaps? does it need to be patched?
      (b)  look at watertrack and bottom track calibrations: what can we expect?


(a)run this command, then add part (or all) of the
   record displayed, to the documetation:

      tail -20  cal/watertrk/adcpcal.out 
--> important info shortcut for the above is catwt.py


 ADCP watertrack calibration
##
 Time range 363.15 to 370.47
   Calculation done at Sat Jan  6 23:37:39 2024
   delta-u min = -100.00, max = 100.00
   delta-v min = -100.00, max = 100.00
   clip_amp = 0.04,  clip_ph =  3.0
   clip_dt =   60,  clip_var = 0.050
Number of edited points:  58 out of  63
   amp   = 1.0028  + 0.0005 (t - 366.4)
   phase =   0.05  + -0.0056 (t - 366.4)
            median     mean      std
amplitude   1.0040   1.0028   0.0086
phase       0.0850   0.0516   0.4597
nav - pc   -1.0000  -0.3276   6.6051
var         0.0000   0.0018   0.0068
min var     0.0000   0.0009   0.0019
delta-u     0.0100  -0.3934   2.8671
delta-v    -0.9800  -0.3355   4.3379




  ===> look at the watertrack figures


 (b) cal/botmtrk/btcaluv.out  (there is no no bottom track data)


 - action: watertrack suggests a scale factor and phase shift
    might be applied after editing 


(4) view the data


  dataviewer.py


(5) 

  - update the navigations steps and redo calibration -- get
  the directory in line with modern tools and metadata


       quick_adcp.py --steps2rerun calib --auto




Now make sure all the edits have been applied and look at the calibration

   quick_adcp.py --steps2rerun apply_edit:navsteps:calib  --auto
   tail -20 cal/watertrk/adcpcal.out


 ADCP watertrack calibration
##
 Time range 363.15 to 370.47
   Calculation done at Sun Jan  7 01:14:35 2024
   delta-u min = -100.00, max = 100.00
   delta-v min = -100.00, max = 100.00
   clip_amp = 0.04,  clip_ph =  3.0
   clip_dt =   60,  clip_var = 0.050
Number of edited points:  59 out of  63
   amp   = 1.0022  + 0.0002 (t - 366.5)
   phase =   0.03  + -0.0031 (t - 366.5)
            median     mean      std
amplitude   1.0040   1.0022   0.0099
phase       0.0600   0.0270   0.4980
nav - pc   -1.0000  -0.3390   6.6166
var         0.0000   0.0017   0.0068
min var     0.0000   0.0009   0.0019
delta-u     0.0200  -0.3846   2.8434
delta-v    -0.5900  -0.3202   4.3024



(6) Edit out any bad points or profiles. Edit out times when the ship was stationary. Edit out data beyond -5 to 5 South along 167 W. Edit out data below 750 meters. Apply threshold editing to reject Error Velocity > 500 mm/s and bins with Percent Good < 80. Use:


     dataviewer.py -e


Let's look at the watertrack now with catwt.py

   **watertrack**  
-----------
Number of edited points:  59 out of  63

            median     mean      std
amplitude   1.0040   1.0022   0.0099
phase       0.0600   0.0270   0.4980



(7) Apply final calibration


   There are 59 points

 # A scale factor ("amplitude") should be applied because median amplitude is greater than 0.003 from 1:

quick_adcp.py --steps2rerun rotate:apply_edit:navsteps:calib --rotate_amplitude 1.006 --auto

   **watertrack**  
-----------
Number of edited points:   8 out of  11

            median     mean      std
amplitude   1.0005   1.0016   0.0119
phase       0.0525  -0.0741   0.6383


 # A phase correction is not warranted because the median is less than 0.1 degrees.


This is much improved. Median and mean amplitudes are less than 0.003 from 1 and phase median is less than 0.01.

 

Look at the figures too

 figview.py  cal/watertrk/wtcal1.png



(6) extract data

  adcp_nc.py adcpdb  contour/os75nb  TN413 os75nb --ship_name Thomas G. Thompson
